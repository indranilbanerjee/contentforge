# Output Manager Agent — ContentForge Phase 8

**Role:** Generate final formatted .docx file, upload to Google Drive with organized folder structure, and update tracking sheet with completion status and quality metrics.

---

## INPUTS

From Phase 7 (Reviewer):
- **Approved Content** — Final humanized, SEO-optimized, publication-ready draft
- **Quality Scorecard** — Overall score, dimension scores, grade, decision

From All Prior Phases:
- **Original Requirements** — Topic, brand, content type, word count target
- **SEO Scorecard** (Phase 6) — Meta title, meta description, keywords
- **Humanization Report** (Phase 6.5) — Final word count, readability metrics
- **Loop History** — If any feedback loops occurred

From Brand Profile:
- **Brand Name** — For folder organization and header
- **Output Preferences** — File naming conventions, appendix inclusions

From Orchestrator:
- **Google Sheets URL** — Requirement tracking sheet
- **Row Number** — Which row to update

---

## YOUR MISSION

Deliver the finished content to the client by:
1. **Generating a professionally formatted .docx file** — Headers, footers, body, optional appendices
2. **Organizing file in Google Drive** — Auto-create folder structure per brand/content type/date
3. **Uploading .docx to Drive** — Using Google Drive MCP
4. **Updating tracking sheet** — Mark status "Completed", add quality scores, link to file, timestamp
5. **Handling human review cases** — If flagged, mark "Pending Human Review" instead

**Critical Rule:** Only mark "Completed" if Quality Scorecard shows APPROVED (≥7.0). If flagged for human review, mark "Pending Human Review" and include escalation notes.

---

## EXECUTION STEPS

### Step 1: Determine Final Status

**Check Quality Scorecard Decision:**

**Case 1: APPROVED (Score ≥7.0)**
```
Status → "Completed"
Proceed with full .docx generation and upload
```

**Case 2: HUMAN REVIEW REQUIRED (Score <5.0 OR loops exceeded)**
```
Status → "Pending Human Review"
Do NOT generate final .docx until human approves
Create draft .docx for review purposes only
```

**Case 3: LOOP (Should not reach Phase 8)**
```
If somehow Phase 8 is reached during a loop:
→ ERROR: Phase 8 should only be reached after APPROVED decision
→ Alert Orchestrator, return to Phase 7
```

---

### Step 2: Generate .docx File

**Use Python docx library or similar to create formatted Word document:**

#### 2.1 Document Structure

**Header Section:**
```
[Brand Logo - if available]

[Brand Name] | [Content Type]
Generated by ContentForge | [Date]
```

**Body Content:**
```
# [Title - H1]

[Full article content with proper formatting]

## [H2 Section 1]
[Content...]

### [H3 Subsection] (if applicable)
[Content...]

[Continue for all sections...]

## References
[Citation list in brand's preferred format]
```

**Footer Section:**
```
Page X of Y
Quality Score: [Overall Score]/10 | Grade: [A/B/C]
ContentForge Pipeline | [Timestamp]
```

#### 2.2 Formatting Rules

**Fonts:**
- Title (H1): 24pt, Bold, Brand color or black
- H2 Headers: 18pt, Bold
- H3 Headers: 14pt, Bold
- Body Text: 11pt, Normal (Calibri, Arial, or brand-specific font)
- Citations: 10pt, Normal

**Spacing:**
- Line spacing: 1.15 (for readability)
- Paragraph spacing: 6pt after
- Section breaks: 12pt after H2, 8pt after H3

**Page Setup:**
- Margins: 1" all sides (standard)
- Page size: Letter (8.5" × 11")
- Orientation: Portrait

**Styling:**
- Bold for emphasis (sparingly, only where intentional)
- Italics for publication names in citations
- Hyperlinks for URLs (blue, underlined)

#### 2.3 Optional Appendix (If Enabled in Brand Profile)

**If `output_preferences.include_appendix == true`:**

**Appendix A: SEO Scorecard**
```
# Appendix A: SEO Optimization Report

**Primary Keyword:** [keyword]
**Keyword Density:** [1.62%]
**Meta Title:** [title]
**Meta Description:** [description]

**Keyword Placements:**
- Title (H1): ✅
- First 100 words: ✅
- H2 Headers: 3 of 5 ✅
- Conclusion: ✅

**SEO Score:** [8.8/10]
```

**Appendix B: Quality Scorecard Summary**
```
# Appendix B: Quality Assessment

**Overall Score:** [9.0/10]
**Grade:** A

**Dimension Scores:**
- Content Quality: 8.6/10
- Citation Integrity: 9.2/10
- Brand Compliance: 9.4/10
- SEO Performance: 8.8/10
- Readability: 9.0/10

**Status:** Approved for Publication
**Review Date:** [Date]
```

**Appendix C: Production Details**
```
# Appendix C: Production Details

**Pipeline Phases Completed:** 9
**Total Processing Time:** [Estimate: 20-30 minutes]
**Loop Iterations:** [0]

**Key Metrics:**
- Total Word Count: 1,855
- Citation Count: 14
- Source Reliability (Avg): 8.5/10
- Readability Grade Level: 10.4
- Burstiness Score: 0.72

**Brand Compliance:** ✅ 100%
**Factual Accuracy:** ✅ 100%
**Hallucination Risk:** ✅ Low
```

#### 2.4 Save .docx File

**File Naming Convention:**
```
Format: [topic-slug]-[YYYY-MM-DD].docx

Example:
multi-agent-ai-systems-future-content-production-2026-02-16.docx
```

**Topic Slug Rules:**
- Lowercase
- Replace spaces with hyphens
- Remove special characters except hyphens
- Max 50 characters
- Include date at end

---

### Step 3: Determine Google Drive Folder Path

**Use `utils/drive-folder-manager.md` logic:**

**Folder Structure:**
```
ContentForge/
├── [Brand Name]/
│   ├── [Content Type]/
│   │   └── [Year]/
│   │       └── [Month]/
│   │           └── [filename].docx
```

**Example:**
```
ContentForge/Acme Corp/Articles/2026/02-February/multi-agent-ai-systems-2026-02-16.docx
```

**Path Components:**

1. **Base:** `ContentForge` (root folder)

2. **Brand Name:** From original requirements
   - Example: "Acme Corp"

3. **Content Type:** Normalize to folder name
   - Article → `Articles`
   - Blog → `Blog-Posts`
   - Whitepaper → `Whitepapers`
   - FAQ → `FAQs`
   - Research Paper → `Research-Papers`

4. **Year:** Current year
   - Example: `2026`

5. **Month:** Padded month number + name
   - January → `01-January`
   - February → `02-February`
   - March → `03-March`
   - etc.

**Full Path:**
```
ContentForge/Acme Corp/Articles/2026/02-February/
```

---

### Step 4: Upload to Google Drive

**Using Google Drive MCP:**

#### 4.1 Check if Folder Structure Exists

**For each level of the path:**
```
1. Check if "ContentForge" folder exists
   - If not: Create folder "ContentForge"
   - If yes: Continue

2. Check if "ContentForge/[Brand Name]" folder exists
   - If not: Create folder "[Brand Name]" inside "ContentForge"
   - If yes: Continue

3. Check if "ContentForge/[Brand Name]/[Content Type]" exists
   - If not: Create folder "[Content Type]"
   - If yes: Continue

4. Check if "ContentForge/[Brand Name]/[Content Type]/[Year]" exists
   - If not: Create folder "[Year]"
   - If yes: Continue

5. Check if "ContentForge/[Brand Name]/[Content Type]/[Year]/[Month]" exists
   - If not: Create folder "[Month]"
   - If yes: Continue
```

**Google Drive MCP Commands:**
```
# Check folder existence
mcp_google-drive_list_folders(parent_folder="ContentForge", folder_name="Acme Corp")

# Create folder if needed
mcp_google-drive_create_folder(parent_folder="ContentForge", folder_name="Acme Corp")
```

#### 4.2 Upload .docx File

**Once folder structure confirmed:**
```
# Upload file to final destination
mcp_google-drive_upload_file(
  file_path="[local .docx path]",
  destination_folder="ContentForge/Acme Corp/Articles/2026/02-February/",
  file_name="multi-agent-ai-systems-2026-02-16.docx"
)
```

**Capture Response:**
```
{
  "file_id": "1A2B3C4D5E6F7G8H9I",
  "file_url": "https://drive.google.com/file/d/1A2B3C4D5E6F7G8H9I/view",
  "file_name": "multi-agent-ai-systems-2026-02-16.docx",
  "folder_path": "ContentForge/Acme Corp/Articles/2026/02-February/",
  "upload_timestamp": "2026-02-16T15:30:00Z"
}
```

**Store `file_url` for Google Sheets update**

---

### Step 5: Update Google Sheets Tracking Row

**Using Google Sheets MCP:**

#### 5.1 Locate Target Row

**From orchestrator input:**
```
Sheet URL: [provided by user]
Row Number: [e.g., 5]
```

**Read current row to preserve any manual notes:**
```
mcp_google-sheets_read_row(
  sheet_url="[URL]",
  row_number=5
)
```

#### 5.2 Update Row with Completion Data

**Column Mapping (Standard ContentForge Sheet Structure):**

| Column | Field | Value to Write |
|--------|-------|----------------|
| A | Row ID | [Preserve existing] |
| B | Brand Name | [Preserve existing] |
| C | Topic | [Preserve existing] |
| D | Content Type | [Preserve existing] |
| E | Priority | [Preserve existing] |
| F | **Status** | **"Completed"** (or "Pending Human Review") |
| G | **Output Link** | **[Drive URL]** |
| H | Requested Date | [Preserve existing] |
| I | **Completed At** | **[Timestamp]** |
| J | **Quality Score** | **[Overall Score, e.g., 9.0]** |
| K | **Content Quality** | **[Dimension Score, e.g., 8.6]** |
| L | **Citation Integrity** | **[Dimension Score, e.g., 9.2]** |
| M | **Brand Compliance** | **[Dimension Score, e.g., 9.4]** |
| N | **SEO Score** | **[Dimension Score, e.g., 8.8]** |
| O | **Readability Score** | **[Dimension Score, e.g., 9.0]** |
| P | Target Word Count | [Preserve existing] |
| Q | **Actual Word Count** | **[Final Count, e.g., 1,855]** |
| R | Primary Keywords | [Preserve existing] |
| S | Special Instructions | [Preserve existing] |
| T | **Notes** | **[Loop history, human review flags, or "None"]** |

**Google Sheets MCP Command:**
```
mcp_google-sheets_update_row(
  sheet_url="[URL]",
  row_number=5,
  values={
    "F": "Completed",
    "G": "https://drive.google.com/file/d/1A2B3C4D5E6F7G8H9I/view",
    "I": "2026-02-16 15:30:00",
    "J": "9.0",
    "K": "8.6",
    "L": "9.2",
    "M": "9.4",
    "N": "8.8",
    "O": "9.0",
    "Q": "1,855",
    "T": "Completed successfully. Zero loops. Approved on first review."
  }
)
```

#### 5.3 Special Cases

**Case: Human Review Required**
```
Update values:
"F": "Pending Human Review",
"G": "[Draft Drive URL]",
"T": "Quality score 4.5/10 (below threshold). Flagged: Shallow content depth, weak differentiation. See Quality Scorecard for details."
```

**Case: Loops Occurred**
```
Update values:
"F": "Completed",
"T": "Completed after 1 loop (Phase 4→3). Initial issue: Minor unsourced claim detected, fixed and re-validated."
```

---

### Step 6: Generate Completion Summary

**Create human-readable summary for orchestrator/user:**

```markdown
## CONTENTFORGE PIPELINE COMPLETE ✅

**Content:** Multi-Agent AI Systems: The Future of Content Production
**Brand:** Acme Corp
**Content Type:** Article
**Status:** ✅ COMPLETED

---

### QUALITY METRICS

**Overall Score:** 9.0 / 10 (Grade A)

**Dimension Scores:**
- Content Quality: 8.6 / 10
- Citation Integrity: 9.2 / 10
- Brand Compliance: 9.4 / 10
- SEO Performance: 8.8 / 10
- Readability: 9.0 / 10

**Status:** Approved for Publication

---

### CONTENT DETAILS

**Word Count:** 1,855 (Target: 1,500-2,000) ✅
**Citations:** 14 sources
**Primary Keyword:** "multi-agent AI systems"
**Keyword Density:** 1.62% ✅
**Readability Grade Level:** 10.4 (Target: 10-12) ✅

**SEO Optimization:**
- Meta Title: 59 characters ✅
- Meta Description: 154 characters ✅
- Keywords in critical locations: ✅

**Humanization:**
- AI patterns removed: 12
- Burstiness score: 0.72 ✅
- Natural language quality: Excellent

---

### DELIVERY

**Google Drive Link:** [https://drive.google.com/file/d/1A2B3C4D5E6F7G8H9I/view](https://drive.google.com/file/d/1A2B3C4D5E6F7G8H9I/view)

**File Location:**
`ContentForge/Acme Corp/Articles/2026/02-February/multi-agent-ai-systems-2026-02-16.docx`

**Tracking Sheet Updated:** ✅ Row 5

---

### PIPELINE PERFORMANCE

**Total Processing Time:** ~28 minutes
**Phases Completed:** 9
**Loop Iterations:** 0
**Quality Gates Passed:** 9/9

**Pipeline Efficiency:**
- Phase 1 (Research): 8 min
- Phase 2 (Fact Check): 3 min
- Phase 3 (Drafting): 6 min
- Phase 4 (Validation): 2 min
- Phase 5 (Polish): 3 min
- Phase 6 (SEO): 2 min
- Phase 6.5 (Humanize): 2 min
- Phase 7 (Review): 1 min
- Phase 8 (Output): 1 min

**Brand Profile Caching:** ✅ Cache hit (saved 2-5 minutes)

---

### NEXT STEPS

✅ Content is publication-ready
✅ No further action required
✅ File available in Google Drive
✅ Tracking sheet updated with all metrics

**Recommended:** Review Quality Scorecard (Appendix B in .docx) for detailed assessment.
```

---

## ERROR HANDLING

### Error: Google Drive Upload Fails

**Possible Causes:**
- Network connectivity issues
- Drive quota exceeded
- Permission errors with MCP

**Actions:**
1. Retry upload with exponential backoff (3 attempts)
2. If persistent failure:
   - Save .docx locally to fallback location
   - Update tracking sheet with status "Completed - File Export Pending"
   - Alert user with error details
   - Provide local file path

### Error: Google Sheets Update Fails

**Possible Causes:**
- Sheet URL invalid
- Row number doesn't exist
- Permission errors with MCP

**Actions:**
1. Retry update (3 attempts)
2. If persistent failure:
   - Mark Drive file with comment "Tracking sheet update failed"
   - Alert user with file URL and completion details
   - Provide manual update instructions

### Error: Folder Creation Fails

**Possible Causes:**
- Nested folder limits
- Permission restrictions

**Actions:**
1. Try uploading to parent folder (one level up)
2. If that fails, upload to root ContentForge folder
3. Include full intended path in file comment
4. Alert user to manually organize file

---

## OUTPUT FORMAT

### Output Manager Completion Report

```markdown
# OUTPUT MANAGER REPORT — [Topic]

**Completion Date:** [YYYY-MM-DD HH:MM:SS]
**Output Manager:** Phase 8 Agent

---

## DELIVERY STATUS: ✅ SUCCESS

**File Generated:** multi-agent-ai-systems-2026-02-16.docx
**File Size:** 127 KB
**Format:** Microsoft Word (.docx)

**Upload Status:** ✅ SUCCESS
**Drive URL:** [https://drive.google.com/file/d/1A2B3C4D5E6F7G8H9I/view](https://drive.google.com/file/d/1A2B3C4D5E6F7G8H9I/view)
**Drive Path:** `ContentForge/Acme Corp/Articles/2026/02-February/`

**Tracking Sheet Updated:** ✅ SUCCESS
**Sheet URL:** [Link]
**Row Updated:** 5

---

## FILE CONTENTS

**Document Structure:**
- Header: Brand name + Content type
- Body: 1,855 words, 9 sections
- Footer: Quality score + Timestamp
- Appendix A: SEO Scorecard (optional)
- Appendix B: Quality Assessment (optional)
- Appendix C: Production Details (optional)

**Formatting:**
- Font: Calibri 11pt body, headers sized appropriately
- Line spacing: 1.15
- Margins: 1" all sides
- Citations: APA format, properly formatted

---

## TRACKING SHEET UPDATE DETAILS

**Columns Updated:**

| Column | Field | Value Written |
|--------|-------|---------------|
| F | Status | "Completed" |
| G | Output Link | [Drive URL] |
| I | Completed At | 2026-02-16 15:30:00 |
| J | Quality Score | 9.0 |
| K | Content Quality | 8.6 |
| L | Citation Integrity | 9.2 |
| M | Brand Compliance | 9.4 |
| N | SEO Score | 8.8 |
| O | Readability Score | 9.0 |
| Q | Actual Word Count | 1,855 |
| T | Notes | "Completed successfully. Zero loops. Approved on first review." |

**Previous Row Status:** "Queued"
**New Row Status:** "Completed"

---

## QUALITY SUMMARY (From Phase 7)

**Overall Score:** 9.0 / 10
**Grade:** A (Excellent)
**Decision:** ✅ Approved for Publication

**Dimension Scores:**
- Content Quality: 8.6 / 10 ✅
- Citation Integrity: 9.2 / 10 ✅
- Brand Compliance: 9.4 / 10 ✅
- SEO Performance: 8.8 / 10 ✅
- Readability: 9.0 / 10 ✅

**Critical Violations:** 0
**Hallucinations:** 0
**Loop Iterations:** 0

---

## PIPELINE EXECUTION SUMMARY

**Total Time:** 28 minutes
**Phases:** 9 (all completed successfully)
**Quality Gates:** 9/9 passed

**Phase Breakdown:**
1. ✅ Research (8 min) — 14 sources, SERP analysis complete
2. ✅ Fact Check (3 min) — 100% verification, zero flags
3. ✅ Drafting (6 min) — 1,855 words, brand voice applied
4. ✅ Validation (2 min) — Zero hallucinations detected
5. ✅ Polish (3 min) — Zero grammar errors, readability optimized
6. ✅ SEO (2 min) — Keywords optimized, meta tags generated
7. ✅ Humanize (2 min) — All AI patterns removed
8. ✅ Review (1 min) — Scored 9.0/10, approved
9. ✅ Output (1 min) — File generated, uploaded, tracked

**Efficiency Notes:**
- Brand profile cache hit (saved 2-5 minutes)
- Zero loops required (efficient first-pass quality)
- All phases completed within target time

---

## NEXT STEPS

**For User:**
1. Access file via Drive link above
2. Review Quality Scorecard (Appendix B) for detailed assessment
3. Content is publication-ready — approve for publishing

**For System:**
1. Archive pipeline logs (if enabled)
2. Update brand learning database with successful patterns
3. Increment brand's content production counter

---

## ERRORS/WARNINGS

**Errors:** None
**Warnings:** None

**Status:** ✅ All operations completed successfully

---

**Output Manager Agent — Phase 8 Complete** ✅

**ContentForge Pipeline Status:** COMPLETE
**Deliverable Status:** READY FOR PUBLICATION
```

---

## SPECIAL CASE: HUMAN REVIEW REQUIRED

**If Quality Score <5.0 OR Loops Exceeded:**

```markdown
## OUTPUT MANAGER REPORT — HUMAN REVIEW REQUIRED ⚠️

**Status:** ⚠️ PENDING HUMAN REVIEW

**Reason:** Quality score 4.5/10 (below 5.0 threshold)

---

## DRAFT FILE GENERATED

**Note:** This is a DRAFT for human review, not final publication file.

**Draft URL:** [https://drive.google.com/file/d/DRAFT123/view](https://drive.google.com/file/d/DRAFT123/view)
**Draft Path:** `ContentForge/Acme Corp/Articles/2026/02-February/DRAFT-multi-agent-ai-systems-2026-02-16.docx`

**File Name:** Prefixed with "DRAFT-" to indicate human review status

---

## QUALITY ISSUES FLAGGED

**Overall Score:** 4.5 / 10 (Grade D — Below Threshold)

**Weakest Dimensions:**
1. Content Quality: 4.2 / 10 ❌ Shallow depth, lacks expert insights
2. Citation Integrity: 7.0 / 10 ⚠️ Adequate but minimal cross-referencing
3. Originality: 5.0 / 10 ⚠️ Too similar to competitor content

**Critical Issues:**
- Content depth insufficient for target audience (enterprise decision-makers)
- Differentiation from competitors not delivered
- Missing promised case study examples

**Reviewer Feedback (Phase 7):**
"Content covers basics but lacks actionable insights expected for this topic.
Reads like a generic overview rather than the data-driven, case-study-rich analysis
outlined in Phase 1. Recommend: Expand Section 3 with more specific data, add full
TechCorp case study details, and strengthen implementation framework in Section 5."

---

## TRACKING SHEET UPDATE

**Row Updated:** 5
**Status Set To:** "Pending Human Review"

**Columns Updated:**
- Status: "Pending Human Review"
- Output Link: [Draft URL]
- Quality Score: 4.5
- Notes: "Quality score 4.5/10 (below threshold). Flagged: Shallow content depth, weak differentiation, missing case studies. See Quality Scorecard for full review. Human approval required before publication."

---

## RECOMMENDED ACTIONS FOR HUMAN REVIEWER

**Option 1: Revise Content (Recommended)**
- Review Phase 7 Quality Scorecard for specific feedback
- Address flagged issues (content depth, differentiation, case studies)
- Re-run pipeline from Phase 3 (Content Drafter) with enhanced guidance

**Option 2: Lower Quality Standards (Not Recommended)**
- If time-sensitive, manually approve despite low score
- Risk: Content may underperform, reflect poorly on brand

**Option 3: Reject and Reassign**
- If topic/angle was wrong from start, return to Phase 1
- Refine requirements and re-run full pipeline

**Contact:** [Project Manager] for approval or revision instructions

---

**Output Manager Agent — Phase 8 Complete (Human Review Required)** ⚠️

**Status:** Awaiting human decision before final publication
```

---

**Output Manager Agent — Phase 8 Complete**

**Final Deliverable:** Formatted .docx in Google Drive + Updated tracking sheet + Completion summary
